<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <title>Point in polygon detection from geocoded point</title>


    <script type="text/javascript"
            src="http://maps.google.com/maps/api/js?libraries=geometry&key=AIzaSyCxitB5jQcw7weQdg9MqBRfxr6mj81wT7I"></script>
    <script type="text/javascript"
            src="https://cdn.jsdelivr.net/gh/geocodezip/geoxml3@master/polys/geoxml3.js"></script>
    <script src="../scripts/v3_epoly.js" type="text/javascript"></script>
    <script type="text/javascript">
      //<![CDATA[
      var geoXml = null
      var map = null
      var geocoder = null
      var toggleState = 1
      var infowindow = null
      var marker = null
      var filename = 'TrashDays40.xml'

      function initialize () {
        geocoder = new google.maps.Geocoder()
        infowindow = new google.maps.InfoWindow({size: new google.maps.Size(150, 50)})

        myLatLng = new google.maps.LatLng(43.502745, -116.240845)
        // these set the initial center, zoom and maptype for the map
        // if it is not specified in the query string
        var lat = 43.502745
        var lng = -116.240845
        var zoom = 12
        var maptype = google.maps.MapTypeId.ROADMAP

        // If there are any parameters at eh end of the URL, they will be in  location.search
        // looking something like  "?marker=3"

        // skip the first character, we are not interested in the "?"
        var query = location.search.substring(1)

        // split the rest at each "&" character to give a list of  "argname=value"  pairs
        var pairs = query.split('&')
        for (var i = 0; i < pairs.length; i++) {
          // break each pair at the first "=" to obtain the argname and value
          var pos = pairs[i].indexOf('=')
          var argname = pairs[i].substring(0, pos).toLowerCase()
          var value = pairs[i].substring(pos + 1).toLowerCase()

          // process each possible argname  -  use unescape() if theres any chance of spaces
          if (argname == 'filename') {filename = unescape(value)}
          if (argname == 'lat') {lat = parseFloat(value)}
          if (argname == 'lng') {lng = parseFloat(value)}
          if (argname == 'zoom') {
            zoom = parseInt(value)
            myGeoXml3Zoom = false
          }
          if (argname == 'type') {
// from the v3 documentation 8/24/2010
// HYBRID This map type displays a transparent layer of major streets on satellite images.
// ROADMAP This map type displays a normal street map.
// SATELLITE This map type displays satellite images.
// TERRAIN This map type displays maps with physical features such as terrain and vegetation.
            if (value == 'm') {maptype = google.maps.MapTypeId.ROADMAP}
            if (value == 'k') {maptype = google.maps.MapTypeId.SATELLITE}
            if (value == 'h') {maptype = google.maps.MapTypeId.HYBRID}
            if (value == 't') {maptype = google.maps.MapTypeId.TERRAIN}

          }
        }
        if (!isNaN(lat) && !isNaN(lng)) {
          myLatLng = new google.maps.LatLng(lat, lng)
        }
        var myOptions = {
          zoom: zoom,
          center: myLatLng,
          // zoom: 5,
          // center: myLatlng,
          mapTypeId: maptype,
        }

        // create the map
        map = new google.maps.Map(document.getElementById('map_canvas'),
          myOptions)
        geoXml = new geoXML3.parser({map: map, singleInfoWindow: true, infoWindow: infowindow})

        geoXml.parse(filename)
        google.maps.event.addListenerOnce(map, 'idle', function () {
          for (var i = 0; i < geoXml.docs[0].placemarks.length; i++) {
            var placemark = geoXml.docs[0].placemarks[i]
            if (placemark.polygon) {
              google.maps.event.addListener(placemark.polygon, 'click', clickHandler)
            }
          }
        })

        google.maps.event.addListener(map, 'click', clickHandler)

        function clickHandler (evt) {
          var contentString = 'click<br>Outside Area'
          var point = evt.latLng
          contentString += '<br>' + point.toUrlValue(6)
          map.setCenter(point)
          if (marker && marker.setMap) marker.setMap(null)
          marker = new google.maps.Marker({
            map: map,
            position: point,
          })
          for (var i = 0; i < geoXml.docs[0].gpolygons.length; i++) {
//          if (geoXml.docs[0].gpolygons[i].Contains(point)) {
            if (google.maps.geometry.poly.containsLocation(point, geoXml.docs[0].gpolygons[i])) {

              contentString = 'click<br>' + geoXml.docs[0].placemarks[i].name
              contentString += '<br>' + point + '<br>polygon#' + i
              i = 999 // Jump out of loop
            }
          }
          google.maps.event.addListener(marker, 'click', function () {
            infowindow.setContent(contentString)
            infowindow.open(map, marker)
          })
          google.maps.event.trigger(marker, 'click')
        }

      }

      function showAddress (address) {
        var contentString = address + '<br>Outside Area'

        geocoder.geocode({'address': address}, function (results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            var point = results[0].geometry.location
            contentString += '<br>' + point
            map.setCenter(point)
            if (marker && marker.setMap) marker.setMap(null)
            marker = new google.maps.Marker({
              map: map,
              position: point,
            })
            for (var i = 0; i < geoXml.docs[0].gpolygons.length; i++) {
//          if (geoXml.docs[0].gpolygons[i].Contains(point)) {
              if (google.maps.geometry.poly.containsLocation(point, geoXml.docs[0].gpolygons[i])) {

                contentString = address + '<br>' + geoXml.docs[0].placemarks[i].name
                contentString += '<br>' + point + '<br>polygon#' + i
                i = 999 // Jump out of loop
              }
            }
            google.maps.event.addListener(marker, 'click', function () {
              infowindow.setContent(contentString)
              infowindow.open(map, marker)
            })
            google.maps.event.trigger(marker, 'click')
          } else {
            alert('Geocode was not successful for the following reason: ' + status)
          }
        })
      }

      //]]>
    </script>
</head>
<body onload="initialize()">
<div id="content">
    <h1>Point in polygon detection from geocoded point</h1>
    <form action="#" onsubmit="showAddress(this.address.value); return false"
          style="padding:10px 0px 30px 0px; background:none;">
        <p>
            <label>Address Search</label>
            <input type="text" size="60" name="address" value="999 Elm St., Boise, ID 83706" class="address"/>
            <input type="submit" value="Search"/>
        </p>
        <div id="map_canvas" style="width: 516px; height: 387px; margin-bottom:30px; border:1px solid #999;"></div>
    </form>

</div>
<div id="sidebar">
</div>
<div class="clear"><!--clear--></div>
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
  _uacct = 'UA-162157-1'
  urchinTracker()
</script>
<div id="w3valid">
    <a href="http://validator.w3.org/check?uri=referer"><!-- target="validationresults" --><img
            src="http://www.w3.org/Icons/valid-xhtml10"
            alt="Valid XHTML 1.0 Transitional" height="31" width="88"/></a>
</div>
</body>
</html>

