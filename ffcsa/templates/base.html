<!doctype html>
<html lang="{{ LANGUAGE_CODE }}"{% if LANGUAGE_BIDI %} dir="rtl"{% endif %}>
{% load pages_tags ffcsa_core_tags shop_tags mezzanine_tags i18n staticfiles static %}
{% load render_bundle from webpack_loader %}

<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="{% block meta_keywords %}{% endblock %}">
    <meta name="description" content="{% block meta_description %}{% endblock %}">

    <title>{% block meta_title %}{% endblock %} |
        {% if settings.SITE_TITLE %}{{ settings.SITE_TITLE }}{% endif %}</title>

    {# Generated by https://realfavicongenerator.net/ #}
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'img/favicon/apple-touch-icon.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'img/favicon/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'img/favicon/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'img/favicon/site.webmanifest' %}">
    <link rel="mask-icon" href="{% static 'img/favicon/safari-pinned-tab.svg' %}" color="#000000">
    <link rel="shortcut icon" href="{% static 'img/favicon/favicon.ico' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
          integrity="sha512-iBBXm8fW90+nuLcSKlbmrPcLa0OT92xO1BIsZ+ywDWZCvqsWgccV3gFoRBv0z+8dLJgyAHIhR35VZc2oM/gI1w=="
          crossorigin="anonymous"/>
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-config" content="{% static 'img/favicon/browserconfig.xml' %}">
    <meta name="theme-color" content="#ffffff">
    {# End favicon config #}

    {% include 'ffcsa_core/includes/rollbar.html' %}

    {% ifinstalled mezzanine.blog %}
        <link rel="alternate" type="application/rss+xml" title="RSS" href="{% url 'blog_post_feed' 'rss' %}">
        <link rel="alternate" type="application/atom+xml" title="Atom" href="{% url 'blog_post_feed' 'atom' %}">
    {% endifinstalled %}

    <!-- vuetify -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css" rel="stylesheet">

    {% if settings.GOOGLE_ANALYTICS_ID %}
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-96409336-1"></script>
        <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', '{{ settings.GOOGLE_ANALYTICS_ID }}');
        </script>
    {% endif %}

    <!-- •• removed below line •• -->
    <!-- render_bundle "manifest" "css"  -->
    {% render_bundle "main" %}

    <!-- to add custom css inside the html pages -->
    {% compress css %}
        <!-- Global CSS -->
        <style>
            /* global css */
            :root {
                --banner-bg: url({% static 'img/banner_mobile.jpg' %});
                --hayden: url({% static 'img/hayden.jpg' %});
                --preston: url({% static 'img/preston.jpg' %});
                --group: url({% static 'img/group.jpg' %});
            }

            @media (min-width: 640px) {
                :root {
                    --banner-bg: url({% static 'img/IMG_0204.jpeg' %});
                }
            }

            .v-navigation-drawer {
                z-index: 999999 !important;
            }

            .v-navigation-drawer.cart-drawer {
                z-index: 9999999 !important;
            }

            .v-application--wrap {
                min-height: auto !important;
            }

            .v-overlay__scrim {
                height: 100vh !important;
            }

            .v-application {
                font-family: 'Helvetica', Arial, "Lucida Grande", sans-serif;
            }

            .menu-triangle {
                /* margin-top: 40px; */
                contain: initial;
                overflow: visible;
            }

            .menu-triangle::before {
                position: absolute;
                content: url("data:image/svg+xml,%3Csvg width='16' height='16' viewBox='0 0 16 16' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12.9094 10.2281L12.8531 10.1625L8.60313 5.27188C8.45938 5.10625 8.24375 5.00313 8.00313 5.00313C7.7625 5.00313 7.54688 5.10938 7.40313 5.27188L3.15625 10.1531L3.08438 10.2344C3.03125 10.3125 3 10.4062 3 10.5062C3 10.7781 3.23125 11 3.51875 11L12.4813 11C12.7688 11 13 10.7781 13 10.5062C13 10.4031 12.9656 10.3063 12.9094 10.2281Z' fill='white'/%3E%3C/svg%3E%0A");
                top: -1rem;
                left: 10%;
                width: 10px;
                height: 13px;
            }

            .alert-fixed {
                position: fixed;
                top: 5rem;
                right: 1rem;
                z-index: 9999999;
            }
            .cart-drawer .v-virtual-scroll__item:last-child > hr {
                display: none;
            }

        </style>

        <!-- Custom CSS per page -->
        {% block css %}{% endblock %}
    {% endcompress %}

    <noscript>
        <img height="1" width="1" style="display:none"
             src="https://www.facebook.com/tr?id=205901347148225&ev=PageView&noscript=1"/>
    </noscript>

    {% block extra_head %}{% endblock %}
</head>

<body id="{% block body_id %}body{% endblock %}" class="{% block body_class %}{% endblock %}" >

<!-- everything -->
<div id="app" v-cloak>
    <v-app>
        <!-- alert compoent -->
        <v-alert border="left" transition="slide-y-transition" :type="$store.state.alert.type"
                 :value="$store.state.alert.value" dense width=300 class="alert-fixed">(($store.state.alert.content))
        </v-alert>

        <!-- Side Cart -->
        <v-navigation-drawer class="cart-drawer" v-model="drawer" width=456 right fixed temporary>
            <!-- header and close button -->
            <v-toolbar elevation="1">
                <v-row>
                    <v-col cols="2"></v-col>
                    <v-col class="d-flex justify-space-around">
                        <v-toolbar-title class="pt-2">
                            <template v-if="store.state.is_authenticated && !isMobile()">
                                Your {% if user.profile.is_member %}Order{% else %}Cart{% endif %} ( ((store.state.cart.items.length)) )
                                <span id="countDown" class="text-base text-red-600"></span>
                            </template>
                            <template v-else-if="store.state.is_authenticated && isMobile()">
                                Your {% if user.profile.is_member %}Order{% else %}Cart{% endif %}
                                <span id="countDown" class="text-base text-red-600"></span>
                            </template>
                            <template v-else>
                                Coming Soon!
                            </template>
                        </v-toolbar-title>
                    </v-col>
                    <v-col cols="2" class="d-flex justify-end">
                        <v-btn icon plain @click="drawer = !drawer">
                            <v-icon color="gray lighten-2">mdi-close</v-icon>
                        </v-btn>
                    </v-col>
                </v-row>
                <v-progress-linear absolute bottom :active="store.state.cart.loading"
                                   :indeterminate="store.state.cart.loading" color="primary"></v-progress-linear>
            </v-toolbar>
            <!-- header and close button -->

            <!-- content -->
            <v-virtual-scroll v-if="store.state.is_authenticated" class="mt-2"
                              :items="store.state.cart.items" :item-height="130" style="height: calc(100% - 13em)">
                <template v-slot:default="{ item }">
                    <v-row class="mt-1 mb-1">
                        <v-col cols="3" class="pb-3 pt-3 pl-3">
                            <v-img :src="'/static/media/' + item.image" height="100%"
                                   max-height="100px" max-width="100px" class="mx-auto">
                            </v-img>
                        </v-col>

                        <v-col cols="9">
                            <div class="flex px-5 pb-2">
                                <h4 class="text-base capitalize">(( item.description.slice(0, 29) ))</h4>
                                <v-spacer></v-spacer>
                                <v-btn text icon color="red lighten-2" @click.prevent="removeCartItem(item)" class="mt-n1">
                                    <v-icon small color="gray lighten-2">mdi-close</v-icon>
                                </v-btn>
                            </div>

                            <div class="flex pl-5 pr-5 items-end">
                                <p class="text-base capitalize">$(( item.unit_price.toFixed(2) ))</p>

                                <div class="ml-auto">
                                    <div class="flex">
                                        <v-btn icon elevation="1" @click="decreaseItemQuantity(item, $event)">
                                            <v-icon color="accent">mdi-minus</v-icon>
                                        </v-btn>

                                        <p class="px-4 pt-1 select-none">((item.quantity))</p>

                                        <v-btn icon elevation="1" @click="increaseItemQuantity(item, $event)"
                                               :disabled="!item.addable">
                                            <v-icon color="accent">mdi-plus</v-icon>
                                        </v-btn>
                                    </div>
                                </div>
                            </div>
                        </v-col>
                    </v-row>

                    <v-divider class="my-2"></v-divider>
                </template>
            </v-virtual-scroll>
            <!-- content -->

            <v-row v-else align="center" justify="center" class="p-5" style="height: 80vh;">
                <p class="text-center p-5 opacity-75	" color="grey lighten-2">
                    Currently we are only accepting online orders for Full Farm CSA members. If you are a member, log in
                    to place your order. If you would like to place an order for Deck Family Farm products, please send
                    give us a call or send us an email.
                </p>
            </v-row>

            <!-- total and checkout -->
            <section v-if="store.state.is_authenticated"
                     class="bg-white absolute px-3 pt-3 inset-x-0 bottom-0 border border-top">
                <div class="flex text-black font-bold">
                    <p class="mb-1">SUBTOTAL</p>
                    <p class="mb-1 ml-auto">$((store.state.cart.total_price))</p>
                </div>

                {% if user.is_authenticated %}
                    {% if user.profile.home_delivery %}
                        <div class="flex text-black font-bold">
                            <p class="mb-1">DELIVERY FEE</p>
                            <p class="mb-1 ml-auto">$((store.state.cart.delivery_fee))</p>
                        </div>
                    {% endif %}
                    <div class="flex text-black font-bold">
                        <p class="mb-0">REMAINING BUDGET</p>
                        <p class="ml-auto mb-0">$((store.state.cart.remaining_budget))</p>
                    </div>
                {% endif %}

                {% is_order_cycle as user_on_order_cycle %}
                {% if not user.profile.is_member %}
                    <v-btn large block color="primary" class="font-weight-bold mt-4" href="/cart"
                           :disabled="!store.state.cart.items.length">CONTINUE TO CHECKOUT
                    </v-btn>
                {% elif user_on_order_cycle%}
                    <p class="text-sm text-center mb-1 mt-1">Your order will be automatically submitted on {% order_period_end %}</p>
                {% else %}
                    <p class="text-sm text-center mb-1 mt-1">Your next order period is from {% order_period_start %} to {% order_period_end %}</p>
                {% endif %}
            </section>
            <!-- total and checkout -->

        </v-navigation-drawer>

        <!-- Menu drawer (mobile only) -->
        <v-navigation-drawer v-model="menu" width='100%' right fixed temporary class="opacity-95">
            <v-btn class="ma-2" absolute top right icon plain @click="menu = !menu" class="ml-auto mt-1 mr-5">
                <v-icon x-large color="gray lighten-2">mdi-close</v-icon>
            </v-btn>

            <v-container fill-height fluid>
                <v-row align="center" justify="center">
                    <v-col cols=12 class="text-center">
                        <v-btn plain class="font-weight-bold" href="/">Home</v-btn>
                    </v-col>
{#                    <v-col cols=12 class="text-center">#}
{#                        <v-btn plain class="font-weight-bold" href="/csa/">Full Farm CSA</v-btn>#}
{#                    </v-col>#}
                    <v-col cols=12 class="text-center">
                        <v-btn plain class="font-weight-bold" href="https://deckfamilyfarm.com" target="_blank">Deck Family Farm</v-btn>
                    </v-col>
                    <v-col cols=12 class="text-center">
                        <v-btn plain class="font-weight-bold" href="/products/">Store</v-btn>
                    </v-col>
{#                    <v-col cols=12 class="text-center">#}
{#                        <v-btn plain class="font-weight-bold" href="/about/">About</v-btn>#}
{#                    </v-col>#}
                    <v-col cols=12 class="text-center">
                        <v-btn plain class="font-weight-bold" href="/faq/">FAQ</v-btn>
                    </v-col>
                    {% if not user.is_authenticated %}
                    <v-col cols=12 class="text-center">
                        <hr class="border-1 border-swirl mb-7">
                        <v-btn color="primary" href="{% url 'signup' %}{% if not 'account' in request.path %}?next={{ request.path }}{% else %}?next=/{% endif %}" class="mx-1 font-weight-bold">
                            BECOME A MEMBER
                        </v-btn>
                    </v-col>
                    <v-col cols=12 class="text-center">
                        <v-btn text href="{% url 'login' %}{% if not 'account' in request.path %}?next={{ request.path }}{% else %}?next=/{% endif %}" class="mx-1 font-weight-bold">
                            LOGIN
                        </v-btn>
                    </v-col>
                    {% endif %}
                    <v-col cols=12 class="text-center">
                        <v-btn class="ma-2" text icon @click="drawer = !drawer">
                            <v-badge :content="store.state.cart.items.length" :value="store.state.cart.items.length"
                                     color="primary" overlap @click="drawer = !drawer">
                                <v-icon large>mdi-cart-outline</v-icon>
                            </v-badge>
                        </v-btn>
                    </v-col>
                </v-row>
            </v-container>
        </v-navigation-drawer>

        <!-- Navbar -->
        <v-app-bar absolute app>

            <!-- Logo -->
            <v-toolbar-title class="mr-5">
                <a href="/"><img class="h-12" src="/static/img/dff-logo-long.png" alt="logo"></a>
            </v-toolbar-title>

            <!-- NavLinks -->
            <div class="d-none d-md-block">
                {#            <v-btn plain class="text-capitalize font-weight-bold" href="/csa/">Full Farm CSA</v-btn>#}
                <v-btn plain class="text-capitalize font-weight-bold" href="https://deckfamilyfarm.com" target="_blank">
                    Deck Family Farm
                </v-btn>
                <v-btn plain class="text-capitalize font-weight-bold" href="/products/">Store</v-btn>
                {#            <v-btn plain class="text-capitalize font-weight-bold" href="/about/">About</v-btn>#}
                <v-btn plain class="text-capitalize font-weight-bold" href="/faq/">FAQ</v-btn>
            </div>

            <v-spacer></v-spacer>

            {% if user.is_authenticated %}
                <!-- User drop down menu -->
                <v-menu offset-y open-on-hover transition="slide-y-transition" bottom close-delay=120 nudge-bottom=5
                        content-class="menu-triangle">
                    <template v-slot:activator="{ on, attrs }">
                        <v-btn v-bind="attrs" v-on="on" text>
                            <v-icon>mdi-account-outline</v-icon>
                            <span class="mx-2 text-capitalize font-weight-bold">{{ user.first_name }}</span>
                            <v-icon>mdi-chevron-down</v-icon>
                        </v-btn>
                    </template>

                    <v-list class="rounded">
                        <v-list-item-group color="primary">
                            <v-list-item v-for="(item, index) in items" :key="index" :href="item.href">
                                <v-list-item-title>(( item.title ))</v-list-item-title>
                            </v-list-item>
                        </v-list-item-group>
                    </v-list>
                </v-menu>
            {% else %}
                <!-- Login and Sing up -->
                <div class="d-none d-md-block">
                    <v-btn color="primary" href="{% url 'signup' %}{% if not 'account' in request.path %}?next={{ request.path }}{% else %}?next=/{% endif %}" class="mx-1 font-weight-bold">
                        BECOME A MEMBER
                    </v-btn>

                    <v-btn text href="{% url 'login' %}{% if not 'account' in request.path %}?next={{ request.path }}{% else %}?next=/{% endif %}" class="mx-1 font-weight-bold">
                        LOGIN
                    </v-btn>
                </div>
            {% endif %}

            <!-- Cart Icon -->
            <v-btn class="d-none d-md-block ma-2" text icon @click="drawer = !drawer">
                <v-badge :content="store.state.cart.items.length" :value="store.state.cart.items.length" color="primary"
                         overlap @click="drawer = !drawer">
                    <v-icon large>mdi-cart-outline</v-icon>
                </v-badge>
            </v-btn>

            <!-- Menu Icon (Small Screen) -->
            <v-btn class="d-md-none ma-2" text icon @click="menu = !menu">
                <v-icon large>mdi-menu</v-icon>
            </v-btn>

        </v-app-bar>

        <!-- Sizes your content based upon application components -->
        <v-main></v-main>

    </v-app>
</div>


<!-- main content -->
<div id="wrapper" class="hiddens">

    <div style="min-height: 100vh; background-color: #fafafa;">
        {% block all_content %}
            {% nevercache %}
                {% if messages %}
                    <!-- <div class="messages">
            {% for message in messages %}
              <div class="alert alert-dismissable alert-{{ message.tags }}" data-alert="alert">
                <button type="button" class="close" data-dismiss="alert"aria-hidden="true">&times;</button>
                {{ message }}
              </div>
            {% endfor %}
          </div> -->
                {% endif %}
            {% endnevercache %}

            {% block topbar %}{% endblock %}

            {% block main_wrapper %}
                {% block main %}{% endblock %}
            {% endblock %}
        {% endblock %}
    </div>

    <!-- Footer -->
    {% if 'accounts' not in request.path %}
        {% include 'partials/footer.html' %}
    {% endif %}

</div>

{% compress js %}
    <!-- Facebook Pixel Code -->
    <script>
        !function (f, b, e, v, n, t, s) {
            if (f.fbq) return;
            n = f.fbq = function () {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = '2.0';
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window, document, 'script',
            'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', '205901347148225');
        fbq('track', 'PageView');
    </script>
    <!-- End Facebook Pixel Code -->

    <!-- Load the JS from bundle -->
    {% render_bundle "main" "js" %}

    <!-- Load scripts -->
    <script src="{% static 'mezzanine/js/'|add:settings.JQUERY_FILENAME %}"></script>
    <script src="{% static 'js/jquery.validate.min.js' %}"></script>
    <script src="{% static 'js/bootstrap.min.js' %}"></script>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14"></script>
    <script src="https://unpkg.com/vuex@3.6.2/dist/vuex.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://js.stripe.com/v3/"></script>

    <!-- Global Config & Variables -->
    <script>
        // Axios config
        axios.defaults.headers = {'X-CSRFToken': '{{csrf_token}}'}

        const static_url = "{% get_static_prefix %}";
        const media_url = "{% get_media_prefix %}";
    </script>

    <!-- Vue Main App Setup -->
    <script>
        const is_authenticated = JSON.parse('{{ user.is_authenticated|json }}').value;
        const can_order = JSON.parse('{{ can_order|json }}');
        const can_order_dairy = JSON.parse('{{ can_order_dairy|json }}');
        // Vuex Store
        const store = new Vuex.Store({
            state: {
                can_order,
                can_order_dairy,
                is_authenticated,
                cart: {
                    shown: false,
                    loading: false,
                    items: [],
                    total_price: 0,
                    delivery_fee: 0,
                    remaining_budget: 0,
                    attending_dinner: 0,
                    last_updated: null
                },
                drop_sites: [],
                alert: {
                    type: 'success',
                    value: false,
                    content: 'Updated now!'
                },
                NON_MEMBERS_MIN_PURCHACE: parseFloat('{{ request.NON_MEMBERS_MIN_PURCHACE }}'),
                rules: {
                    required: value => !!value || 'This field is required',
                    password: value => value.length >= 6 || 'Password should be 6 characters or more',
                    // phone: value => true || 'Invalid phone number',
                    phone: value => (value == '' || value == null || /\d\d\d-\d\d\d-\d\d\d\d/.test(value)) || 'Invalid phone number',
                    email: value => {
                        const pattern = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/
                        return pattern.test(value) || 'Invalid email'
                    },
                }
            },
            mutations: {
                showAlert(state, val = {type: 'success', content: 'Updated successfuly'}) {
                    this.state.alert = {...this.state.alert, ...val}
                    this.state.alert.value = true;
                }
            }
        })

        // Vuetify options
        const opts = {
            theme: {
                themes: {
                    light: {
                        primary: '#e16231',
                        secondary: '#b0bec5',
                        accent: '#914323',
                        error: '#b71c1c',
                        green: '#5f8c49',
                        brown: '#914323',
                        brown_lightest: '#efe8e4',
                        brown_darkest: '#502616',
                        green_lightest: '#e8ebe2',
                        info: '#7c9b65',
                        warning: '#e67f51',
                    },
                    dark: {
                        primary: '#e16231',
                        info: '#7c9b65',
                        warning: '#e67f51',
                    }
                },
                // dark: true
            },
        }

        // Vue App
        const App = new Vue({
            el: '#app',
            delimiters: ['((', '))'],
            store,
            vuetify: new Vuetify(opts),
            data() {
                return {
                    drawer: false,
                    menu: false,
                    counter: 0,

                    items: [
                        {title: 'Account settings', href: '/accounts/update/'},
                        {title: 'Email us', href: 'mailto:fullfarmcsa@deckfamilyfarm.com'},
                        {title: 'My orders', href: '/accounts/update/?section=orders'},
                        {title: 'Feed a friend', href: '/accounts/update/?section=feed'},
                        {title: 'Logout', href: `{% url 'logout' %}?next={{ request.get_full_path }}`},
                    ],

                    showNavDropdown: false,
                    showUserDropdown: false,
                }
            },
            methods: {
                isMobile() {
                    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
                },
                async fetchCart() {
                    store.state.cart.loading = true;

                    try {
                        const res = await axios.get('/api/cart/');
                        const {
                            id,
                            items,
                            total_price,
                            delivery_fee,
                            remaining_budget,
                            attending_dinner,
                            last_updated
                        } = res.data
                        console.log(res.data)
                        store.state.cart.items = items;
                        store.state.cart.total_price = total_price;
                        store.state.cart.delivery_fee = delivery_fee;
                        store.state.cart.remaining_budget = parseFloat(remaining_budget).toFixed(2);
                        store.state.cart.attending_dinner = attending_dinner;
                        store.state.cart.last_updated = last_updated;
                        store.state.cart.loading = false;

                        // {% if not user.is_authenticated %}
                            if (items.length > 0) {
                                this.startCartCountDown()
                            }
                            // {% endif %}


                    } catch (error) {
                        console.log('Fetch Cart Error', error)
                        store.state.cart.loading = false;
                        // console.log('Fetch Cart Error', error.response.data)
                    }
                },
                async addToCart(variation) {
                    // Add item to session cart
                    const res = await axios.post(`/api/product_variations/${variation.id}/add_to_cart/`)

                    ProductsVue.hideProductModal();
                    this.drawer = !this.drawer;
                    this.fetchCart();

                    // update products if user in products page
                    if (location.href.includes('/products/')) {
                        ProductsVue.getProducts()
                    }
                },
                async removeCartItem(item) {
                    // remove an item from cart
                    const res = await axios.post(`/api/cart/${item.id}/remove_item/`);
                    this.fetchCart()

                    // update products if user in products page
                    if (location.href.includes('/products/')) {
                        ProductsVue.getProducts()
                    }
                },
                async clearCart() {
                    // remove all items from cart and rest attending_dinner to 0
                    const res = await axios.post('/api/cart/clear/');
                    this.fetchCart()

                    // update products if user in products page
                    if (location.href.includes('/products/')) {
                        ProductsVue.getProducts()
                    }
                },

                // per item
                async increaseItemQuantity(item, event) {
                    // increase CartItem quantity
                    const controlContainer = event.target.parentElement
                    // disable buttons
                    controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);

                    try {
                        const res = await axios.post(`/api/cart/${item.id}/increase_item/`);
                        this.fetchCart();

                        // update products if user in products page
                        if (location.href.includes('/products/')) {
                            ProductsVue.getProducts()
                        }

                        // enable buttons
                        controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    } catch (error) {
                        console.log(error)
                        // enable buttons
                        controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    }
                },
                async decreaseItemQuantity(item, event) {
                    // increase CartItem quantity
                    const controlContainer = event.target.parentElement
                    // disable buttons
                    controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);

                    try {
                        const res = await axios.post(`/api/cart/${item.id}/decrease_item/`);
                        this.fetchCart();

                        // update products if user in products page
                        if (location.href.includes('/products/')) {
                            ProductsVue.getProducts()
                        }

                        // enable buttons
                        controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    } catch (error) {
                        console.log(error)
                        // enable buttons
                        controlContainer.querySelectorAll('button').forEach(btn => btn.disabled = false);
                    }
                },

                // get drop sites
                async getDropSites() {
                    try {
                        const res = await axios.post(`/api/resources/get_drop_sites/`);
                        store.state.drop_sites = res.data.sites
                    } catch (error) {
                        console.log(error.response.data)
                        store.commit('showAlert', {type: 'error', content: error.response.data.detail})
                    }
                },

                // {% if not user.is_authenticated %}
                    startCartCountDown() {
                        // Set the date we're counting down to
                        // var countDownDate = new Date(new Date(store.state.cart.last_updated).getTime() + 21*60000);

                        // Update the count down every 1 second
                        var x = setInterval(function () {

                            // Get today's date and time
                            var now = new Date().getTime();

                            // Find the distance between now and the count down date
                            var distance = App.countDownDate - now;

                            // Time calculations for days, hours, minutes and seconds
                            var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                            var seconds = Math.floor((distance % (1000 * 60)) / 1000);

                            // Display the result in the element with id="countDown"
                            document.getElementById("countDown").innerHTML = "Expires in " + minutes + "m " + seconds + "s ";

                            // If the count down is finished, write some text
                            if (distance < 0) {
                                clearInterval(x);
                                document.getElementById("countDown").innerHTML = "EXPIRED";
                                this.fetchCart()
                            }
                        }, 1000);

                    },
                    // {% endif %}

                hide_alert: function (event) {
                    // console.log('Hide')
                    // `event` is the native DOM event
                    window.setInterval(() => {
                        store.state.alert.value = false;
                        // console.log("hide alert after 3 seconds");
                    }, 3000)
                }
            },
            watch: {
                '$store.state.alert.value': function (val) {
                    if (val) {
                        setTimeout(() => {
                            // if (this.notification.text.length < 65) this.notification.shown = false
                            this.hide_alert();
                        }, 3000);
                    }
                }
            },
            computed: {
                countDownDate() {
                    return new Date(new Date(store.state.cart.last_updated).getTime() + 21 * 60000);
                }

            },
            async mounted() {
                // get the cart using user session
                this.fetchCart()
                this.getDropSites()

                // hide alert
                // if(alert){
                //   this.hide_alert();
                // }
            }

        })
    </script>

    <script defer>
        // close side-cart if open
        document.addEventListener('keyup', e => {
            if (e.key === "Escape") {
                App.drawer = false;
            }
        })
    </script>

    <!-- Custom JS per page -->
    {% block js %}{% endblock %}
{% endcompress %}
</body>
</html>
